<html>
	<head>
		<style>
			body {
				font-family: sans-serif;
				margin: 0;
				padding: 0;
				overflow: hidden;
				display: flex;
				flex-direction: column;
				height: 100%;
				width: 100%;
			}
			.key {
				color: #6666cc;
			}
			#running {
				display: none;
			}
			#json {
				font-family: monospace;
				white-space: pre;
				overflow: auto;
				flex-shrink: 1;
				padding-left: 3px;
				padding-right: 3px;
			}
			#conf {
				background-color: #ccc;
				padding: 5px;
				display: flex;
				flex-direction: row;
			}
			#conf input {
				flex-grow: 1;
			}
		</style>
		<script>
			function ajax (url, callback) {
				var xhr = new XMLHttpRequest();
				xhr.open('get', url);
				
				// Track the state changes of the request.
				xhr.onreadystatechange = function () {
					if (xhr.readyState === 4) {
						switch(xhr.status) {
						case 200:
							callback(null,xhr.responseText);break;
						case 404:
							callback(xhr.status + ' File not found');break;
						case 500:
							callback(xhr.status + ' Server error');break;
						case 0:
							callback(xhr.status + ' Request aborted');break;
						default:
							callback(xhr.status + ' Unknown error');
						}
					}
				};
				
				xhr.send(null);
			}
		
			function get (id) {
				return document.getElementById(id);
			}
			
			function hide (id) {
				get(id).style.display = 'none';
			}
			
			function show (id) {
				get(id).style.display = 'block';
			}
			
			function prettify (o,indent,name) {
				var tab = '    '.repeat(indent);
				if (name) {
					name = '<span class="key">' + name + '</span>: ';
				} else {
					name = '';
				}
				if (typeof o == 'string') {
					return tab + name + '"' + o + '"';
				}
				if (typeof o == 'number' ||
					typeof o == 'boolean' ||
					typeof o == 'undefined' ||
					o === null
				) {
					return tab + name + o;
				}
				if (o instanceof Array) {
					if (o.length) {
						var items = [];
						for (var i=0;i<o.length;i++) {
							items.push(prettify(o[i],0));
						}
						if (items.join(', ').length < 100) {
							return tab + name + '[ ' + items.join(', ') + ' ]';
						} else {
							items = [];
							for (var i=0;i<o.length;i++) {
								items.push(prettify(o[i],indent+1));
							}
							var ret = tab + name + '[\n';
							ret += items.join(',\n') + '\n';
							ret += tab + ']';
							return ret;
						}
					} else {
						return tab + name + '[]';
					}
				}
				// object
				var items = [];
				
				for (var i in o) {
					items.push(prettify(o[i],0,i));
				}
				if (items.length == 0) {
					return tab + name + '{}';
				}
				if (items.join(', ').length < 100) {
					return tab + name + '{ ' + items.join(', ') + ' }';
				} else {
					items = [];
					for (var i in o) {
						items.push(prettify(o[i],indent+1,i));
					}
					var ret = tab + name + '{\n';
					ret += items.join(',\n') + '\n';
					ret += tab + '}';
					return ret;
				}
			}
			
			var polling = false;
			function poll() {
				ajax('http://' + get('url').value,function(err,data){
					if (err) {
						get('json').innerHTML = 'Error: ' + err;
					}
					else {
						get('json').innerHTML = prettify(JSON.parse(data),0);
					}
					if (polling) setTimeout(poll,1000);
				})
			}
			
			function connect () {
				var url = get('url');
				var btn = get('connect');
				if (polling) {
					btn.innerHTML = 'Connect';
					url.readOnly = false;
					url.style.backgroundColor = 'white';
					polling = false;
				}
				else {
					btn.innerHTML = 'Disconnect';
					url.readOnly = true;
					url.style.backgroundColor = '#ccc';
					polling = true;
					poll();
				}
			}
			
			window.onload = function(){
				get('connect').onclick = connect;
				get('url').onkeypress = function(e){
					if (e.keyCode == '13') connect();
				};
			}
		</script>
	</head>
	<body>
		<div id="conf">
			http://<input id="url"></input> <button id="connect">Connect</button>
		</div>
		<div id="json">
		</div>
	</body>
</html>
